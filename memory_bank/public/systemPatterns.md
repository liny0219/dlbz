# 系统架构模式

## 核心架构设计
- **多进程架构**：主进程负责GUI与配置，子进程负责自动化业务与日志采集
- **模块化设计**：设备管理、OCR、战斗、玩法逻辑等核心功能模块化，便于扩展与维护
- **配置驱动**：采用YAML文件，支持多玩法/多城市灵活切换，支持热更新
- **日志系统**：采用loguru统一日志，主进程与子进程日志分离，GUI实时显示

## 通信机制
- **进程间通信**：通过Queue从子进程实时推送到主进程GUI
- **线程安全**：截图缓存使用锁机制，支持引用计数和智能清理
- **资源管理**：完善的资源清理机制，防止内存泄漏

## 核心模块架构
```
主进程 (GUI)
├── 主窗口 (MainWindow)
├── 玩法面板 (FengmoPanel, FarmingPanel, MemoryPanel, DailyPanel)
├── 设置面板 (SettingsPanel)
└── 日志面板 (LogPanel)

子进程 (业务逻辑)
├── 设备管理 (DeviceManager)
├── OCR识别 (OCRHandler)
├── 战斗系统 (Battle, BattleCommandExecutor)
├── 玩法模式 (FengmoMode, FarmingMode, MemoryMode, DailyMode)
└── 世界管理 (World)
```

## 设计模式应用
- **统一接口模式**：所有玩法模式遵循相同的初始化和运行接口
- **状态管理模式**：完整的运行状态跟踪和统计
- **配置模式**：通过配置参数控制功能启用和行为
- **观察者模式**：GUI实时观察业务逻辑状态变化

## 优化成果
- **内存管理**：OCR模型缓存、截图缓存清理、线程资源管理
- **性能优化**：配置缓存、OCR结果缓存、智能日志轮转
- **错误处理**：多层级异常捕获、状态恢复、用户友好提示
- **可维护性**：完善的注释、模块化设计、统一的代码风格 